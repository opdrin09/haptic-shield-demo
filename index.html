<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HapticShield | UnB</title>
    <style>
        /* --- DESIGN SYSTEM --- */
        :root {
            --neon: #00ff41;
            --warn: #ffcc00;
            --danger: #ff3333;
            --bg: #0a0a0a;
            --panel: #111;
            --border: #333;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { 
            margin: 0; background: var(--bg); font-family: 'Courier New', Courier, monospace; 
            color: #eee; overflow-x: hidden; 
        }

        /* --- APRESENTA√á√ÉO --- */
        #landing-page { padding: 20px; max-width: 800px; margin: 0 auto; padding-bottom: 120px; }

        header { text-align: center; padding: 40px 0; border-bottom: 1px solid var(--border); margin-bottom: 30px; }
        .logo { font-size: 2.5rem; font-weight: 900; letter-spacing: -2px; color: #fff; text-shadow: 0 0 15px var(--neon); }
        .logo span { color: var(--neon); }
        .sub { color: #888; font-size: 0.8rem; letter-spacing: 2px; margin-top: 5px; }

        h2 { border-left: 4px solid var(--neon); padding-left: 15px; margin-top: 40px; color: #fff; text-transform: uppercase; }
        p { color: #aaa; line-height: 1.6; font-size: 0.95rem; margin-bottom: 20px; }
        
        .highlight { color: var(--neon); font-weight: bold; }
        .danger-text { color: var(--danger); font-weight: bold; }

        /* CARDS TUTORIAL */
        .tutorial-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 20px; }
        .step-card { background: var(--panel); border: 1px solid var(--border); padding: 15px; border-radius: 8px; position: relative; }
        .step-num { position: absolute; top: -10px; left: -10px; background: var(--neon); color: #000; width: 25px; height: 25px; border-radius: 50%; font-weight: bold; display: flex; align-items: center; justify-content: center; }
        .step-title { color: #fff; font-weight: bold; margin-bottom: 5px; display: block; }
        .step-desc { font-size: 0.8rem; color: #888; }

        /* BOT√ÉO PRINCIPAL */
        .cta-container { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.95); padding: 20px; text-align: center; border-top: 1px solid var(--neon); z-index: 100; }
        .btn-launch {
            background: var(--neon); color: #000; border: none; padding: 15px 40px; font-size: 1.2rem; font-weight: 900; cursor: pointer;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.3); width: 100%; max-width: 400px; clip-path: polygon(10% 0, 100% 0, 100% 100%, 90% 100%, 0 100%, 0 0);
        }
        .btn-launch:active { transform: scale(0.95); background: #fff; }
        
        .btn-test { background: transparent; border: 1px solid #555; color: #aaa; padding: 8px 15px; font-size: 0.7rem; cursor: pointer; margin-bottom: 10px; }

        /* --- SIMULADOR (HIDDEN) --- */
        #sim-layer { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 999; }
        #cam-feed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.4; filter: grayscale(100%) contrast(1.2); z-index: 0; }
        
        .hud-content { position: relative; z-index: 10; height: 100%; display: flex; flex-direction: column; justify-content: space-between; padding: 15px; }
        
        .sim-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--neon); padding-bottom: 10px; background: rgba(0,0,0,0.5); }
        .clock-time { font-size: 2.5rem; font-weight: bold; line-height: 1; color: #fff; }
        .clock-label { font-size: 0.6rem; color: var(--neon); letter-spacing: 1px; text-align: right;}

        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .data-box { background: rgba(255,255,255,0.05); padding: 10px; border: 1px solid #333; }
        .data-val { font-size: 1.2rem; font-weight: bold; color: #fff; }
        .data-lbl { font-size: 0.6rem; color: #888; }

        .hp-track { height: 15px; background: #222; border: 1px solid #555; margin-top: 5px; transform: skewX(-15deg); }
        .hp-fill { height: 100%; width: 100%; background: var(--neon); transition: width 0.1s linear; }

        .trigger-zone { display: flex; flex-direction: column; align-items: center; padding-bottom: 30px; }
        #trigger-btn {
            width: 110px; height: 110px; border-radius: 50%; border: 4px solid var(--neon); color: var(--neon); background: rgba(0,20,0,0.6);
            display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem; text-align: center;
            box-shadow: 0 0 20px var(--neon); user-select: none;
        }
        #trigger-btn.active { background: var(--danger); border-color: var(--danger); color: #000; box-shadow: 0 0 50px var(--danger); transform: scale(0.95); }

        #fail-screen {
            position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(20,0,0,0.95); z-index: 20;
            display: none; flex-direction: column; align-items: center; justify-content: center; border: 5px solid var(--danger);
        }
        .fail-stamp { font-size: 3rem; color: var(--danger); border: 4px solid var(--danger); padding: 10px; transform: rotate(-5deg); font-weight: 900; margin-bottom: 20px; text-shadow: 0 0 20px red; }
    </style>
</head>
<body>

    <div id="landing-page">
        <header>
            <div class="logo">HAPTIC<span>SHIELD</span></div>
            <div class="sub">SISTEMA DE TREINAMENTO VMB | UnB 2025</div>
        </header>

        <section>
            <h2>O Problema Invis√≠vel</h2>
            <p>A vibra√ß√£o ocupacional (VMB) destr√≥i capilares e nervos. Operadores de marteletes frequentemente excedem o limite legal da <span class="highlight">ISO 5349</span> sem perceber.</p>
            
            <img src="Fig1_ISO5349_Limites.png" style="width:100%; border: 1px solid #333; border-radius: 8px; margin: 20px 0; min-height: 200px; background: #111;" alt="Gr√°fico de Limites ISO 5349">
            
            <p>Este simulador utiliza a tecnologia h√°ptica do seu smartphone para demonstrar como <strong>19 m/s¬≤</strong> de vibra√ß√£o consomem sua "vida vascular" em minutos.</p>
        </section>

        <section>
            <h2>Configura√ß√£o Obrigat√≥ria</h2>
            <p class="danger-text">‚ö†Ô∏è ATEN√á√ÉO: Ative estas op√ß√µes ou o celular N√ÉO vibrar√°:</p>
            
            <div class="tutorial-grid">
                <div class="step-card">
                    <div class="step-num">1</div>
                    <span class="step-title">Som & Vibra√ß√£o</span>
                    <span class="step-desc">Nas config. do Android, ative "Vibra√ß√£o do Sistema" e "Ao Tocar".</span>
                </div>
                <div class="step-card">
                    <div class="step-num">2</div>
                    <span class="step-title">Modo Energia</span>
                    <span class="step-desc">Desligue a "Economia de Bateria". Ela bloqueia vibra√ß√µes.</span>
                </div>
                <div class="step-card">
                    <div class="step-num">3</div>
                    <span class="step-title">Volume</span>
                    <span class="step-desc">Aumente o volume do celular (o Chrome liga vibra√ß√£o ao som).</span>
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn-test" onclick="testVibration()">üõ†Ô∏è CLIQUE PARA TESTAR VIBRA√á√ÉO</button>
                <div id="test-msg" style="font-size: 0.7rem; color: #666; margin-top: 5px; height: 20px;"></div>
            </div>
        </section>
    </div>

    <div class="cta-container" id="cta-layer">
        <button class="btn-launch" onclick="launchSimulator()">ACESSAR SIMULADOR</button>
        <p style="font-size: 0.6rem; color: #555; margin-top: 5px;">Ao clicar, permita o uso da C√¢mera para RA</p>
    </div>


    <div id="sim-layer">
        <video id="cam-feed" autoplay playsinline muted></video>
        
        <div class="hud-content">
            <div>
                <div class="sim-header">
                    <div style="font-size: 0.8rem; color: #aaa;">TURNO<br>SIMULADO</div>
                    <div class="clock-box">
                        <div class="clock-time" id="clock">00:00</div>
                        <div class="clock-label">HORAS : MINUTOS</div>
                    </div>
                </div>

                <div class="data-grid">
                    <div class="data-box">
                        <div class="data-val" id="val-acc" style="color:var(--warn)">0.0</div>
                        <div class="data-lbl">VIBRA√á√ÉO (m/s¬≤)</div>
                    </div>
                    <div class="data-box">
                        <div class="data-val" id="val-dose">0.00</div>
                        <div class="data-lbl">DOSE A(8)</div>
                    </div>
                </div>

                <div style="margin-top: 15px;">
                    <div style="display:flex; justify-content:space-between; font-size:0.7rem;">
                        <span>SA√öDE VASCULAR</span>
                        <span id="hp-txt">100%</span>
                    </div>
                    <div class="hp-track">
                        <div class="hp-fill" id="hp-bar"></div>
                    </div>
                </div>
            </div>

            <div class="trigger-zone">
                <div id="trigger-btn">SEGURE<br>PARA<br>OPERAR</div>
                <div style="font-size: 0.6rem; color: #666; margin-top: 10px;">ESCALA: 1s = 2min</div>
            </div>
        </div>

        <div id="fail-screen">
            <div class="fail-stamp">FALHA</div>
            <h2 style="color: #fff;">LIMITE EXCEDIDO</h2>
            <p style="color: #aaa;">NECROSE TECIDUAL IMINENTE</p>
            
            <div style="background: #222; padding: 20px; margin: 20px; border: 1px solid #444; text-align: left; width: 80%;">
                <p>‚è±Ô∏è Tempo Seguro: <strong style="color: #fff">33 min</strong></p>
                <p>üíÄ Tempo Operado: <strong style="color: var(--danger)" id="final-time">00:00</strong></p>
                <p>üìà Dose Final: <strong style="color: var(--danger)" id="final-dose">5.00</strong></p>
            </div>

            <button class="btn-launch" style="background: #333; color: #fff; border: 1px solid #fff;" onclick="resetSim()">REINICIAR</button>
            <button class="btn-test" style="margin-top: 15px; border: none;" onclick="location.reload()">VOLTAR AO IN√çCIO</button>
        </div>
    </div>

    <script>
        // --- CORRE√á√ÉO DO BUG JS ---
        function testVibration() {
            const msg = document.getElementById('test-msg');
            if (navigator.vibrate) {
                navigator.vibrate(200);
                msg.innerText = "Comando enviado! Se tremeu, est√° pronto.";
                msg.style.color = "#00ff41"; // Corrigido aqui: string hexadecimal v√°lida
            } else {
                msg.innerText = "Navegador sem suporte a vibra√ß√£o (iOS?).";
                msg.style.color = "orange";
            }
        }

        async function launchSimulator() {
            document.getElementById('landing-page').style.display = 'none';
            document.getElementById('cta-layer').style.display = 'none';
            document.getElementById('sim-layer').style.display = 'block';

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                document.getElementById('cam-feed').srcObject = stream;
            } catch (e) {
                console.log("C√¢mera negada. Usando fundo preto.");
                document.getElementById('cam-feed').style.display = 'none';
            }
        }

        // --- L√ìGICA F√çSICA ---
        const TOOL_ACC = 19.0;
        const LIMIT = 5.0;
        const TIME_SCALE = 120; // 1s = 2min
        
        let simSeconds = 0;
        let dose = 0;
        let isRunning = false;
        let loopTimer, vibeTimer;

        const els = {
            clock: document.getElementById('clock'),
            acc: document.getElementById('val-acc'),
            dose: document.getElementById('val-dose'),
            hpBar: document.getElementById('hp-bar'),
            hpTxt: document.getElementById('hp-txt'),
            btn: document.getElementById('trigger-btn'),
            fail: document.getElementById('fail-screen')
        };

        function startTool(e) {
            if(e) e.preventDefault();
            if(dose >= LIMIT) return;

            isRunning = true;
            els.btn.classList.add('active');
            els.btn.innerHTML = "VIBRA√á√ÉO<br>ATIVA";

            if(navigator.vibrate) {
                navigator.vibrate([400, 30, 400, 30]);
                vibeTimer = setInterval(() => {
                    if(isRunning) navigator.vibrate([400, 30]);
                }, 430);
            }

            loopTimer = setInterval(() => {
                simSeconds += (0.1 * TIME_SCALE);
                let t_hours = simSeconds / 3600;
                dose = TOOL_ACC * Math.sqrt(t_hours / 8);

                let h = Math.floor(simSeconds / 3600);
                let m = Math.floor((simSeconds % 3600) / 60);
                els.clock.innerText = `${h<10?'0'+h:h}:${m<10?'0'+m:m}`;

                els.acc.innerText = (TOOL_ACC + (Math.random()-0.5)).toFixed(1);
                els.dose.innerText = dose.toFixed(2);

                let hp = Math.max(0, 100 - (dose/LIMIT)*100);
                els.hpBar.style.width = hp + "%";
                els.hpTxt.innerText = Math.floor(hp) + "%";

                if(hp < 30) els.hpBar.style.background = "#ff3333"; // Var CSS hardcoded para JS seguro
                else els.hpBar.style.background = "#00ff41";

                if(dose >= LIMIT) failState();

            }, 100);
        }

        function stopTool(e) {
            if(e) e.preventDefault();
            isRunning = false;
            els.btn.classList.remove('active');
            els.btn.innerHTML = "SEGURE<br>PARA<br>OPERAR";
            els.acc.innerText = "0.0";

            clearInterval(loopTimer);
            clearInterval(vibeTimer);
            if(navigator.vibrate) navigator.vibrate(0);
        }

        function failState() {
            stopTool();
            if(navigator.vibrate) navigator.vibrate(1000);
            document.getElementById('final-time').innerText = els.clock.innerText;
            document.getElementById('final-dose').innerText = dose.toFixed(2);
            els.fail.style.display = 'flex';
        }

        function resetSim() {
            simSeconds = 0;
            dose = 0;
            els.clock.innerText = "00:00";
            els.dose.innerText = "0.00";
            els.hpBar.style.width = "100%";
            els.hpBar.style.background = "#00ff41";
            els.fail.style.display = 'none';
        }

        const b = els.btn;
        b.addEventListener('mousedown', startTool);
        b.addEventListener('mouseup', stopTool);
        b.addEventListener('mouseleave', stopTool);
        b.addEventListener('touchstart', startTool, {passive: false});
        b.addEventListener('touchend', stopTool, {passive: false});
    </script>
</body>
</html>
