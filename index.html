<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HapticShield | Sistema VMB</title>
    <style>
        /* --- EST√âTICA ENGENHARIA HARDCORE --- */
        :root { --neon: #0f0; --warn: #ff0; --danger: #f00; --bg: #050505; }
        body { margin: 0; overflow: hidden; background: var(--bg); font-family: 'Courier New', Courier, monospace; user-select: none; -webkit-touch-callout: none; }

        /* CAMADA DE V√çDEO (RA) */
        #cam-feed { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 0; opacity: 0.5; filter: grayscale(100%) contrast(1.2); }
        
        /* TELAS (OVERLAYS) */
        .screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.95); transition: opacity 0.5s; padding: 20px; box-sizing: border-box; text-align: center; }
        .hidden { opacity: 0; pointer-events: none; }

        /* HUD PRINCIPAL */
        #hud { justify-content: space-between; background: transparent; padding: 10px; }
        
        /* ELEMENTOS DE UI */
        h1 { color: var(--neon); margin: 0 0 10px 0; text-shadow: 0 0 10px var(--neon); letter-spacing: 2px; }
        .box { border: 1px solid #444; background: rgba(255,255,255,0.05); padding: 15px; width: 100%; max-width: 350px; margin-bottom: 20px; text-align: left; }
        ul { padding-left: 20px; color: #aaa; font-size: 0.85rem; line-height: 1.6; }
        li { margin-bottom: 5px; }

        /* BOT√ïES */
        .btn-start { background: var(--neon); color: #000; border: none; padding: 15px 40px; font-weight: 900; font-size: 1.2rem; cursor: pointer; box-shadow: 0 0 20px rgba(0,255,0,0.4); clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%); }
        .btn-reset { background: #333; color: #fff; border: 1px solid #fff; padding: 10px 30px; margin-top: 20px; cursor: pointer; }

        /* BOT√ÉO DE OPERA√á√ÉO (O GATILHO) */
        .trigger-area { padding-bottom: 50px; display: flex; flex-direction: column; align-items: center; }
        #trigger-btn {
            width: 110px; height: 110px; border-radius: 50%;
            border: 4px solid var(--neon); color: var(--neon);
            background: rgba(0,20,0,0.6);
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 0.9rem; text-align: center;
            box-shadow: 0 0 15px var(--neon); transition: all 0.1s;
            user-select: none; -webkit-user-select: none;
        }
        #trigger-btn.active { background: var(--danger); border-color: var(--danger); color: #000; transform: scale(0.95); box-shadow: 0 0 40px var(--danger); }

        /* DADOS NO HUD */
        .data-panel { width: 100%; background: rgba(0,0,0,0.7); border-top: 2px solid var(--neon); padding: 10px; }
        .metric { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 1.1rem; color: #fff; }
        .label { font-size: 0.7rem; color: #888; }
        
        /* BARRA DE VIDA */
        .health-container { height: 30px; background: #222; border: 2px solid #555; position: relative; margin-top: 10px; transform: skewX(-15deg); }
        .health-bar { height: 100%; width: 100%; background: linear-gradient(90deg, var(--neon), var(--warn)); transition: width 0.1s linear; }
        .health-text { position: absolute; top: 4px; left: 0; width: 100%; text-align: center; color: #000; font-weight: bold; font-size: 0.8rem; transform: skewX(15deg); }

        /* ANIMA√á√ÉO DE PERIGO */
        @keyframes flash-red { 0% {box-shadow: inset 0 0 0 red;} 50% {box-shadow: inset 0 0 50px red;} 100% {box-shadow: inset 0 0 0 red;} }
        .critical { animation: flash-red 0.5s infinite; }
    </style>
</head>
<body>

    <video id="cam-feed" autoplay playsinline muted></video>

    <div id="start-screen" class="screen">
        <h1>HAPTIC<span style="color:#fff">SHIELD</span></h1>
        <p style="color:#888; margin-bottom:20px; font-size:0.8rem;">SISTEMA DE TREINAMENTO VMB v2.1</p>
        
        <div class="box">
            <strong style="color:#fff; display:block; border-bottom:1px solid #555; padding-bottom:5px; margin-bottom:10px;">PR√â-REQUISITOS OBRIGAT√ìRIOS:</strong>
            <ul>
                <li>üîä Ative o <strong>Som/Vibra√ß√£o</strong> do celular.</li>
                <li>üîã Desligue <strong>"Economia de Bateria"</strong>.</li>
                <li>üì≥ Ative <strong>"Feedback T√°til"</strong> nas config.</li>
                <li>‚ö†Ô∏è <strong>iPhone (iOS):</strong> Apenas Visual (Sem Vibra√ß√£o).</li>
            </ul>
        </div>

        <button class="btn-start" onclick="initSystem()">INICIAR SISTEMA</button>
    </div>

    <div id="hud" class="screen hidden">
        <div class="data-panel" style="background:transparent; border:none; text-align:left;">
            <div style="color:var(--neon); font-size:0.8rem;">‚óè SISTEMA ONLINE</div>
            <div style="color:#aaa; font-size:0.6rem;">API: ISO-5349-1 INTEGRATION</div>
        </div>

        <div style="width:100%;">
            <div class="data-panel">
                <div class="metric">
                    <span class="label">ACELERA√á√ÉO (RMS)</span>
                    <span id="val-acc">0.0 m/s¬≤</span>
                </div>
                <div class="metric">
                    <span class="label">DOSE A(8) PROJ.</span>
                    <span id="val-dose">0.00</span>
                </div>
                
                <div class="health-container">
                    <div class="health-bar" id="hp-bar"></div>
                    <div class="health-text">INTEGRIDADE VASCULAR</div>
                </div>
            </div>
        </div>

        <div class="trigger-area">
            <div id="trigger-btn">SEGURE<br>PARA<br>OPERAR</div>
            <div style="margin-top:10px; font-size:0.7rem; color:#666;">MANTENHA PRESSIONADO</div>
        </div>
    </div>

    <div id="fail-screen" class="screen hidden" style="background:rgba(20,0,0,0.98);">
        <h1 style="color:var(--danger); border:3px solid var(--danger); padding:10px; transform:rotate(-3deg);">FALHA CR√çTICA</h1>
        <h2 style="color:#fff; margin-top:20px;">S√çNDROME DE RAYNAUD</h2>
        <p style="color:#aaa;">DANO TECIDUAL IRREVERS√çVEL DETECTADO</p>
        
        <div class="box" style="text-align:center; border-color:var(--danger);">
            <p style="color:#fff; font-size:1.5rem;" id="final-dose">0.00 m/s¬≤</p>
            <p style="color:var(--danger); font-size:0.8rem;">LIMITE ISO-5349 EXCEDIDO</p>
        </div>

        <button class="btn-reset" onclick="location.reload()">REINICIAR SIMULA√á√ÉO</button>
    </div>

    <script>
        // --- L√ìGICA DO SISTEMA ---
        let hp = 100;
        let dose = 0;
        let isRunning = false;
        
        // Refer√™ncias
        const startScreen = document.getElementById('start-screen');
        const hud = document.getElementById('hud');
        const failScreen = document.getElementById('fail-screen');
        const btn = document.getElementById('trigger-btn');
        const hpBar = document.getElementById('hp-bar');
        
        // Timers
        let loopInterval;
        let vibrateInterval;

        // 1. INICIALIZA√á√ÉO (C√¢mera + UX)
        async function initSystem() {
            // Feedback t√°til inicial para testar se o navegador deixa
            if(navigator.vibrate) navigator.vibrate(200);
            
            startScreen.classList.add('hidden');
            hud.classList.remove('hidden');

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                document.getElementById('cam-feed').srcObject = stream;
            } catch (e) {
                console.log("C√¢mera n√£o autorizada. Usando modo escuro.");
                document.getElementById('cam-feed').style.display = 'none';
            }
        }

        // 2. SIMULA√á√ÉO F√çSICA
        function startTool(e) {
            if(e) e.preventDefault(); // Evita sele√ß√£o de texto/menu
            if(hp <= 0) return;

            isRunning = true;
            btn.classList.add('active');
            btn.innerHTML = "VIBRA√á√ÉO<br>ATIVA";

            // Padr√£o de Vibra√ß√£o (Britadeira: 100ms ON, 50ms OFF)
            if(navigator.vibrate) {
                navigator.vibrate([100, 50, 100, 50, 100, 50, 100, 50]); 
                vibrateInterval = setInterval(() => {
                    if(isRunning) navigator.vibrate([100, 50]);
                }, 150);
            }

            // Loop de C√°lculo (60fps aprox)
            loopInterval = setInterval(() => {
                // Gerar dados ruidosos (15 a 22 m/s¬≤)
                let acc = 15 + Math.random() * 7;
                document.getElementById('val-acc').innerText = acc.toFixed(1) + " m/s¬≤";

                // Acumular Dose (Acelerado para demo)
                dose += 0.08;
                document.getElementById('val-dose').innerText = dose.toFixed(2);

                // Dano Vascular
                hp -= 0.6; 
                hpBar.style.width = hp + "%";

                // Mudan√ßa de Estados Visuais
                if(hp < 50) hpBar.style.background = "var(--warn)";
                if(hp < 25) {
                    hpBar.style.background = "var(--danger)";
                    hud.classList.add('critical'); // Piscar vermelho
                }

                // Game Over
                if(hp <= 0) triggerFailure();

            }, 100);
        }

        function stopTool(e) {
            if(e) e.preventDefault();
            isRunning = false;
            btn.classList.remove('active');
            btn.innerHTML = "SEGURE<br>PARA<br>OPERAR";
            hud.classList.remove('critical');
            
            document.getElementById('val-acc').innerText = "0.0 m/s¬≤";

            // Parar tudo
            clearInterval(loopInterval);
            clearInterval(vibrateInterval);
            if(navigator.vibrate) navigator.vibrate(0);
        }

        function triggerFailure() {
            stopTool();
            document.getElementById('final-dose').innerText = "A(8) Final: " + dose.toFixed(2);
            failScreen.classList.remove('hidden');
            hud.classList.add('hidden');
            if(navigator.vibrate) navigator.vibrate([500, 100, 500]); // Vibra√ß√£o de erro longa
        }

        // 3. BINDING DE EVENTOS (Touch e Mouse)
        btn.addEventListener('mousedown', startTool);
        btn.addEventListener('mouseup', stopTool);
        btn.addEventListener('mouseleave', stopTool);
        
        btn.addEventListener('touchstart', startTool, {passive: false});
        btn.addEventListener('touchend', stopTool, {passive: false});

    </script>
</body>
</html>
